var UM_Conv_Ajax=!1;function um_Hide_Emobox(){var e=jQuery("span.um-message-emolist");e.is(":visible")&&e.hide()}function um_Chatbox(e){var t=e.val().length,s=e.attr("data-maxchar"),a=s-t;jQuery(".um-message-limit:visible").html(a),""!=e.val()?jQuery(".um-message-send:visible").removeClass("disabled"):jQuery(".um-message-send:visible").addClass("disabled"),s<t?(jQuery(".um-message-limit:visible").addClass("exceed"),jQuery(".um-message-send:visible").addClass("disabled")):(jQuery(".um-message-limit:visible").removeClass("exceed"),""!=e.val()&&jQuery(".um-message-send:visible").removeClass("disabled"))}jQuery(document.body).on("click",".um-login #um-submit-btn",function(){document.cookie="um_messaging_invite_login=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"});var um_conversations_loaded=!1;function um_messaging_init_conversations_list(){var e=jQuery(".um-message-conv");e.length&&e.each(function(){jQuery(this).css({"max-height":"500px"});var e=new SimpleBar(this);e.recalculate(),e.getScrollElement().addEventListener("scroll",function(){var e={allow:!0,reallow:function(){e.allow=!0},delay:400},t=jQuery(this).parents("[data-simplebar]"),o=t.find(".um-message-conv-load-more");if(!um_conversations_loaded&&e.allow&&(e.allow=!1,o.length)){setTimeout(e.reallow,e.delay);var n=jQuery(this);if((a=jQuery(this).offset().top-o.offset().top-jQuery(this).scrollTop())<200){var s=t.data("user"),a=t.find(".um-message-conv-item").length,r=window.location.href;um_conversations_loaded=!0,o.show(),wp.ajax.send("um_conversations_load",{data:{user_id:s,offset:a,url:r,nonce:um_scripts.nonce},success:function(e){if(0<e.length){var t=wp.template("um_messages_convesations"),s=o.detach(),a=t({conversations:e});n.append(a).append(s)}else o.remove();um_conversations_loaded=!1},error:function(e){console.log(e),um_conversations_loaded=!1}})}}})})}function Init_BodyConv(){var e=jQuery(".um-profile-body.messages .um-message-autoheight");e.length&&e.each(function(){jQuery(this).css({"max-height":"500px"}),new SimpleBar(this).recalculate()})}function UM_Refresh_Conv(){var t=jQuery(".um-message-ajax");if(t.length&&t.is(":visible")&&!UM_Conv_Ajax){var e=t.data("message_to"),s=t.data("conversation_id"),a=t.data("last_updated");if("new"===s)return;if(UM_Refresh_Conv.state&&"run"===UM_Refresh_Conv.state)return;wp.ajax.send("um_messaging_update",{data:{message_to:e,conversation_id:s,last_updated:a,nonce:um_scripts.nonce},success:function(e){e&&(UM_Update_UTC_to_LocalTime(),0==t.find('.um-message-item[data-message_id="'+e.message_id+'"]').length&&"nothing_new"!==e.response&&(jQuery(".um-message-ajax").append(e.response),jQuery(".um-popup-autogrow")[0].SimpleBar.getScrollElement().scrollTo(0,jQuery(".um-popup-autogrow").find(".simplebar-content").outerHeight()+jQuery(".um-popup-autogrow")[0].scrollHeight),t.data("last_updated",e.last_updated)))},error:function(e){console.log(e)},beforeSend:function(e){UM_Refresh_Conv.state="run"},complete:function(e){UM_Refresh_Conv.state="ready"}})}}function UM_Update_UTC_to_LocalTime(){jQuery(".um-message-item-time").each(function(){if(""==jQuery(this).attr("title")||""==jQuery(this).attr("original-title")){var e=jQuery(this).attr("um-message-utc-time"),t=jQuery(this).attr("um-messsage-timestamp"),s=moment(t,"X").tz(moment.tz.guess()).format("LLLL");jQuery(this).attr("title",s),jQuery(this).attr("original-title",e)}})}function um_messages_get_url_vars(){for(var e,t=[],s=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),a=0;a<s.length;a++)e=s[a].split("="),t.push(e[0]),t[e[0]]=e[1];return t}function um_getCaret(e){if(e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();if(null==t)return 0;var s=e.createTextRange(),a=s.duplicate();return s.moveToBookmark(t.getBookmark()),a.setEndPoint("EndToStart",s),a.text.length}return 0}function um_getPosInRow(e){var t=um_getCaret(e);return e.value.substr(0,t).replace(/^(.*[\n\r])*([^\n\r]*)$/,"$2").length}function um_setCaretPosition(e,t){e.setSelectionRange(t,t),e.umCaretPosition={start:t,end:t},e.focus()}function um_getCaretPosition(e){if("selectionStart"in e&&document.activeElement===e)return{start:e.selectionStart,end:e.selectionEnd};if(e.createTextRange){var t=document.selection.createRange();if(t.parentElement()===e){var s=e.createTextRange();s.moveToBookmark(t.getBookmark());for(var a=0;0<s.compareEndPoints("EndToStart",s);s.moveEnd("character",-1))a++;s.setEndPoint("StartToStart",e.createTextRange());for(var o={start:0,end:a};0<s.compareEndPoints("EndToStart",s);s.moveEnd("character",-1))o.start++,o.end++;return o}}return-1}jQuery(document).ready(function(){if(jQuery(document.body).on("mouseenter",".um-message-item",function(){jQuery(this).find(".um-message-item-show-on-hover").show()}),jQuery(document.body).on("mouseleave",".um-message-item",function(){jQuery(this).find(".um-message-item-show-on-hover").hide()}),um_messages.can_read&&setInterval(UM_Refresh_Conv,um_messages.interval),um_messaging_init_conversations_list(),Init_BodyConv(),UM_Update_UTC_to_LocalTime(),jQuery(document.body).on("click",".um-message-unblock",function(e){e.preventDefault();var t=jQuery(this).attr("data-user_id");return jQuery(this).parents(".um-message-blocked").fadeOut("fast"),wp.ajax.send("um_messaging_unblock_user",{data:{user_id:t,nonce:um_scripts.nonce},success:function(e){UM_Update_UTC_to_LocalTime()},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-blocku:not(.um-message-blocked-true)",function(e){e.preventDefault();var t=jQuery(this).attr("data-confirm_text");if(confirm(t)){jQuery(this).addClass("um-message-blocked-true");var s=jQuery(this).attr("data-conversation_id"),a=jQuery(this).attr("data-other_user");jQuery(".tipsy").remove(),jQuery(".um-message-body,.um-message-footer,.um-message-header-left").css({opacity:.5}),jQuery('.um-message-conv-item[data-conversation_id="'+s+'"]').remove(),jQuery(".um-message-footer").empty(),jQuery(".um-message-item-remove").remove(),jQuery("a.um-message-delconv").addClass("disabled"),wp.ajax.send("um_messaging_block_user",{data:{other_user:a,nonce:um_scripts.nonce},success:function(e){},error:function(e){console.log(e)}})}return!1}),jQuery(document.body).on("click",".um-message-delconv.disabled",function(e){return e.preventDefault(),!1}),jQuery(document.body).on("click",".um-message-delconv",function(e){e.preventDefault();var t=jQuery(this).attr("data-conversation_id"),s=jQuery(this).attr("data-other_user");return jQuery(".tipsy").remove(),jQuery(".um-message-conv-view").length?(jQuery(".um-message-conv-item[data-conversation_id="+t+"]").remove(),jQuery(".um-message-conv-item").length&&jQuery(".um-message-conv-view").is(":visible")&&jQuery(".um-message-conv-item:first").trigger("click"),jQuery(".um-message-conv-view").empty()):remove_Modal(),0==jQuery(".um-message-conv").find(".um-message-conv-item").length&&(jQuery(".um-profile-body.messages").append('<div class="um-message-noconv"><i class="um-icon-android-chat"></i>'+um_message_i18n.no_chats_found+"</div>"),jQuery(".um-profile-body.messages").find(".um-message-conv, .um-message-conv-view").hide()),wp.ajax.send("um_messaging_delete_conversation",{data:{conversation_id:t,other_user:s,nonce:um_scripts.nonce},success:function(e){},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-hide",function(e){return e.preventDefault(),remove_Modal(),!1}),jQuery(document.body).on("click",".um-login-to-msg-btn",function(e){e.preventDefault();var t=jQuery(e.currentTarget).css({cursor:"wait"}),s=jQuery("#um_messaging_hidden_login .um-modal"),a=t.attr("data-message_to");if(s.length){if(jQuery("body").hasClass("um-page-members")){var o,n=document.body.className.match(/(^|\s)page-id-(\d+)(\s|$)/);n&&(o=n[2]);var r=jQuery(".um-members-pagi .current").text()}return wp.ajax.send("um_messaging_login_modal",{data:{message_to:a,page_id:o,current_page:r,nonce:um_scripts.nonce},success:function(e){"string"==typeof e.content&&(s.find(".um-message-header").remove(),s.find(".um-message-modal").prepend(e.content),s.find(".um-message-hide").show(),s.siblings(".um-modal-overlay").remove(),s.removeClass("um-modal-hidden").show().after('<div class="um-modal-overlay"></div>')),"string"==typeof e.redirect_url&&s.find("#redirect_to").val(e.redirect_url),s.find(".g-recaptcha").length&&"object"==typeof grecaptcha&&grecaptcha.reset(),"function"==typeof um_modal_responsive?um_modal_responsive():"function"==typeof responsive_Modal&&responsive_Modal(),setTimeout(function(){jQuery(document.body).trigger("resize")},200),jQuery(document).trigger("um_messaging_open_login_form")},error:function(e){console.log(e)}}),!1}window.location.assign(t.attr("href"))}),jQuery("#um_messaging_hidden_login").on("click",".um-modal-overlay, .um-message-hide",function(e){e.stopPropagation(),jQuery(e.delegateTarget).find(".um-modal").addClass("um-modal-hidden").hide().siblings(".um-modal-overlay").remove(),jQuery(".um-login-to-msg-btn").css({cursor:"pointer"}),jQuery(document).trigger("um_messaging_close_login_form")}),jQuery(document.body).ready(function(){setTimeout(function(){jQuery("body.um-page-user .um-popup-autogrow:visible").length&&jQuery("body.um-page-user .um-popup-autogrow:visible")[0].SimpleBar.getScrollElement().scrollTo(0,jQuery(".um-popup-autogrow:visible").find(".simplebar-content").outerHeight()+jQuery(".um-popup-autogrow:visible")[0].scrollHeight)},1e3)}),jQuery(document.body).on("click",".um-message-conv-item",function(e){if(e.preventDefault(),jQuery(this).attr("data-trigger_modal")&&jQuery(".um-message-conv-view").is(":hidden"))return!1;if(jQuery(this).hasClass("active")||UM_Conv_Ajax)return!1;UM_Conv_Ajax=!0;var t=jQuery(this),s=jQuery(this).html();jQuery(this).find("img").replaceWith('<span class="um-message-cssload"><i class="um-faicon-circle-o-notch"></i></span>');var a=jQuery(this).attr("data-message_to");return window.history.pushState("string","Conversation",jQuery(this).attr("href")),wp.ajax.send("um_messaging_start",{data:{message_to:a,nonce:um_scripts.nonce},success:function(e){e&&(UM_Update_UTC_to_LocalTime(),jQuery(".um-message-conv-view").html(e),t.html(s),jQuery(".um-message-conv-item").removeClass("active"),t.addClass("active"),Init_BodyConv(),jQuery(".um-tip-n").tipsy({gravity:"n",opacity:1,offset:3,delayIn:500}),jQuery(".um-tip-w").tipsy({gravity:"w",opacity:1,offset:3,delayIn:500}),jQuery(".um-tip-e").tipsy({gravity:"e",opacity:1,offset:3,delayIn:500}),jQuery(".um-tip-s").tipsy({gravity:"s",opacity:1,offset:3,delayIn:500}),UM_Conv_Ajax=!1,setTimeout(function(){jQuery(".um-popup-autogrow:visible").length&&jQuery(".um-popup-autogrow:visible")[0].SimpleBar.getScrollElement().scrollTo(0,jQuery(".um-popup-autogrow:visible").find(".simplebar-content").outerHeight()+jQuery(".um-popup-autogrow:visible")[0].scrollHeight)},1e3))},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-item-remove",function(e){e.preventDefault();var t=jQuery(this).parents(".um-message-item").attr("data-message_id"),s=jQuery(this).parents(".um-message-item").attr("data-conversation_id");return jQuery(this).parents(".um-message-item").fadeOut("fast"),wp.ajax.send("um_messaging_remove",{data:{message_id:t,conversation_id:s,nonce:um_scripts.nonce},success:function(e){e&&e.count_messages<1&&jQuery(".um-message-header-right .um-gdpr-donwload-link").hide()},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-emo",function(){jQuery("span.um-message-emolist").is(":visible")?um_Hide_Emobox():jQuery("span.um-message-emolist").show()}),jQuery(document.body).on("click",".um-message-emolist span.um-message-insert-emo",function(e){var t=jQuery(this).attr("data-emo"),s=jQuery(e.target).closest(".um-message-textarea").find("textarea.um_message_text"),a=s.prop("umCaretPosition")?s.prop("umCaretPosition").end:0,o=s.val().substr(0,a),n=s.val().substr(a,s.val().length),r=(o+" "+t+" ").length;s.val(o+" "+t+" "+n),um_setCaretPosition(s.get(0),r),um_Hide_Emobox(),um_Chatbox(s),s.focus()}),jQuery(document.body).on("click",'.um-message-btn:not(.um-login-to-msg-btn), *[data-trigger_modal="conversation"]',function(e){if(e.preventDefault(),jQuery(this).attr("data-trigger_modal")&&jQuery(".um-message-conv-view").is(":visible"))return!1;var t=jQuery(this).attr("data-message_to");return jQuery(".um-message-conv-item").removeClass("active"),jQuery(this).addClass("active"),prepare_Modal(),wp.ajax.send("um_messaging_start",{data:{message_to:t,nonce:um_scripts.nonce},success:function(e){e?(show_Modal(e),responsive_Modal(),autosize(jQuery(".um-message-textarea textarea:visible")),setTimeout(function(){jQuery(".um-popup-autogrow:visible").length&&jQuery(".um-popup-autogrow:visible")[0].SimpleBar.getScrollElement().scrollTo(0,jQuery(".um-popup-autogrow:visible").find(".simplebar-content").outerHeight()+jQuery(".um-popup-autogrow:visible")[0].scrollHeight)},1e3)):remove_Modal()},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-send:not(.disabled)",function(){var e=jQuery(this);e.addClass("disabled");var t=e.parents(".um-message-footer").siblings(".um-message-body").data("message_to"),s=e.parents(".um-message-footer").find(".um_message_text").val();return wp.ajax.send("um_messaging_send",{data:{message_to:t,content:s,nonce:um_scripts.nonce},success:function(e){var t=jQuery(".um-message-textarea textarea:visible");UM_Update_UTC_to_LocalTime(),t.val(""),jQuery(".um-message-body:visible").find(".um-message-ajax:visible").html(e.messages).data("last_updated",e.last_updated),jQuery('[data-conversation_id="'+e.conversation_id+'"]').length?jQuery('[data-conversation_id="'+e.conversation_id+'"]').show():jQuery('[data-conversation_id="new"]').data("conversation_id",e.conversation_id).show(),jQuery(".um-gdpr-donwload-link:visible").attr("href",e.chat_history_download),e.limit_hit&&jQuery(".um-message-footer:visible").html(jQuery(".um-message-footer:visible").data("limit_hit")),jQuery(".um-message-footer:visible").find(".um-message-limit").html(t.data("maxchar")),jQuery(".um-popup-autogrow:visible")[0].SimpleBar.getScrollElement().scrollTo(0,jQuery(".um-popup-autogrow:visible").find(".simplebar-content").outerHeight()+jQuery(".um-popup-autogrow:visible")[0].scrollHeight)},error:function(e){jQuery(".um-message-textarea textarea:visible").val(""),console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-send.disabled",function(e){return e.preventDefault(),!1}),jQuery(document.body).on("click","textarea.um_message_text",function(e){um_Hide_Emobox()}),jQuery(document.body).on("keyup keydown keypress","textarea.um_message_text",function(e){um_Hide_Emobox(),um_Chatbox(jQuery(this))}).on("click touchend keyup","textarea.um_message_text",function(e){e.target.umCaretPosition=um_getCaretPosition(e.target)}),jQuery(document.body).on("paste","textarea.um_message_text",function(e){var t=jQuery(this),s=e.originalEvent.clipboardData.getData("text");um_Hide_Emobox();var a=t.val().length+s.length,o=t.attr("data-maxchar"),n=o-a;jQuery(".um-message-limit:visible").html(n),t.val()+s!=""?jQuery(".um-message-send:visible").removeClass("disabled"):jQuery(".um-message-send:visible").addClass("disabled"),o<a?(jQuery(".um-message-limit:visible").addClass("exceed"),jQuery(".um-message-send:visible").addClass("disabled")):(jQuery(".um-message-limit:visible").removeClass("exceed"),t.val()+s!=""&&jQuery(".um-message-send:visible").removeClass("disabled"))}),0<jQuery(".um-profile-nav-item.um-profile-nav-messages.active").length)if(void 0!==um_messages_get_url_vars().conversation_id){var e=um_messages_get_url_vars().conversation_id;jQuery(".um-message-conv-item[data-conversation_id="+e+"]").click()}else jQuery(".um-message-conv-item[data-conversation_id]").first().click()});