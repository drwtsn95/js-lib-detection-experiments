/*
 * XenForo gallery_bb_code.min.js
 * Copyright 2010-2017 XenForo Ltd.
 * Released under the XenForo License Agreement: http://xenforo.com/license-agreement
 */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,e,d){b instanceof String&&(b=String(b));for(var f=b.length,a=0;a<f;a++){var c=b[a];if(e.call(d,c,a,b))return{i:a,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,d){b!=Array.prototype&&b!=Object.prototype&&(b[e]=d.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,e,d,f){if(e){d=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var a=b[f];a in d||(d[a]={});d=d[a]}b=b[b.length-1];f=d[b];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,d){return $jscomp.findInternal(this,b,d).v}},"es6","es3");
!function(b,e,d,f){XenForo.XenGalleryButtons=function(a){this.__construct(a)};XenForo.XenGalleryButtons.prototype={__construct:function(a){this.textarea=a;b(d).bind({EditorInit:b.context(this,"editorInitFunc")})},editorInitFunc:function(a,c){c.$textarea[0]==this.textarea[0]&&c.editor.options.enableXmgButton&&c.config.buttonsCustom.custom_gallery&&(c.config.buttonsCustom.custom_gallery.callback=b.context(this,"galleryButtonCallback"))},galleryButtonCallback:function(a){var c=this.ed=a,g=c.$box.find(".xengallery_browser"),
d=this;a=c.$box.find(".redactor_smilies");c=c.$box.find(".redactor_btn_smilies");a.hide();c.bind({click:function(){g.hide()}});g.length?g.slideToggle():d.loadPending||(d.loadPending=!0,XenForo.ajax("index.php?xengallery/editor-browser","",b.context(this,"loadSuccess")).complete(function(){b(".mediaTabContent").show();d.loadPending=!1}))},loadSuccess:function(a){XenForo.hasResponseError(a)||a.templateHtml&&new XenForo.ExtLoader(a,b.context(this,"createBrowser"))},createBrowser:function(a){var c=this.ed;
a=b('<div class="xengallery_browser" />').html(a.templateHtml);a.hide();a.on("click",".Thumb",function(a){a.preventDefault();a=b(this);a="[GALLERY="+a.data("type")+", "+a.data("id")+"]"+XenForo.htmlspecialchars(a.data("title"))+"[/GALLERY]";c.execCommand("inserthtml",a);c.focus()});c.$box.append(a);a.xfActivate();a.slideToggle();this.browser=a.find(".browserSection");this.browser.bind({scroll:b.context(this,"beginScroll")})},beginScroll:function(a){a=this.browser;if(a.find(".IsLastPage").length)return!1;
var c=a.scrollTop()+a.outerHeight(),d=a.get(0).scrollHeight,e=this;c!=d||this.loadPending||(this.loadPending=!0,a=a.find(".PageNumber:last"),XenForo.ajax("index.php?xengallery/editor-browser",{last_page:a.val()},b.context(this,"loadMoreSuccess")).complete(function(){b(".mediaTabContent").show();e.loadPending=!1}))},loadMoreSuccess:function(a){XenForo.hasResponseError(a)||a.templateHtml&&new XenForo.ExtLoader(a,b.context(this,"updateBrowser"))},updateBrowser:function(a){this.browser.find(".gridSection").append(a.templateHtml).xfShow()}};
XenForo.XenGalleryLazyLoader=function(a){this.__construct(a)};XenForo.XenGalleryLazyLoader.prototype={__construct:function(a){this.ignoreActivate=!1;a.bind({XenForoActivate:b.context(this,"elementActivate")});this.checkForItems()},checkForItems:function(){this.timer&&clearTimeout(this.timer);var a=[],c=b(".GalleryLazyLoad");b.each(c,function(c,d){a.push({type:b(d).data("type"),id:b(d).data("id")})});if(!a.length)return!1;this.loadGalleryItems(a,c)},elementActivate:function(){this.ignoreActivate||
(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(b.context(this,"checkForItems"),50))},loadGalleryItems:function(a,c){this.xhr=XenForo.ajax("index.php?xengallery/content-loader",{items:a},b.context(this,"ajaxSuccess"));this.xhr.complete(function(){c&&c.removeClass("GalleryLazyLoad")})},ajaxSuccess:function(a){if(XenForo.hasResponseError(a))return!1;a.gallery&&new XenForo.ExtLoader(a,function(){this.ignoreActivate=!0;b.each(a.gallery,function(a,d){a=a.split("/").pop();var c=b(a+":first");
c.removeClass("GalleryLazyLoad");b(d.html).xfInsert("replaceAll",c,"xfFadeIn",XenForo.speed.normal,function(){b(this).trigger("elementResized")});b(a+"ContentLink").attr("href",d.contentLink)});this.ignoreActivate=!1})}};XenForo.register("textarea.BbCodeWysiwygEditor","XenForo.XenGalleryButtons");XenForo.register(".GalleryLazyLoader","XenForo.XenGalleryLazyLoader")}(jQuery,this,document);
